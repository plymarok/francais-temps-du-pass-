<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>R√©visions ‚Äî Valeurs des temps du pass√© (4e)</title>
<style>
  :root{
    --bg:#f6f8fb; --card:#ffffff; --ink:#0f172a; --muted:#475569;
    --brand:#38bdf8; --brand-2:#a78bfa;
    --ok:#16a34a; --no:#dc2626;
    --rose:#d81b60;    /* Imparfait */
    --green:#15803d;   /* Pass√© simple */
    --orange:#ea580c;  /* Plus-que-parfait */
    --radius:16px; --shadow:0 10px 28px rgba(2,8,23,.08);
  }
  *{box-sizing:border-box}
  body{margin:0; font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--ink)}
  header{
    background: linear-gradient(135deg, var(--brand), #3b82f6 60%);
    color:#fff; padding:28px 18px; text-align:center;
  }
  header h1{margin:0 0 6px; font-size:clamp(1.25rem,2.2vw,1.8rem)}
  header p{margin:0; opacity:.9}
  nav{
    position:sticky; top:0; z-index:50; background:#fff; border-bottom:1px solid #e2e8f0;
    display:flex; gap:10px; align-items:center; padding:8px 12px; overflow:auto;
  }
  nav button{
    background:#fff; border:1px solid #e2e8f0; color:#0f172a; padding:8px 12px; border-radius:999px; cursor:pointer;
  }
  nav button.active{background:#0ea5e9; color:#fff; border-color:#0ea5e9}
  main{max-width:1000px; margin:20px auto; padding:0 12px 40px}
  .card{background:var(--card); border:1px solid #e2e8f0; border-radius:var(--radius); box-shadow:var(--shadow); padding:20px; margin:14px 0}
  h2{margin:0 0 12px; font-size:clamp(1.1rem,2vw,1.4rem)}
  table{border-collapse:collapse; width:100%}
  th,td{border:1px solid #e2e8f0; padding:10px; text-align:left}
  th{background:#f1f5f9}
  .legend{font-size:.9rem; color:var(--muted)}
  .chip{display:inline-flex; align-items:center; gap:6px; padding:2px 10px; border-radius:999px; border:1px solid #e2e8f0; background:#fff; margin-right:6px}
  .imparfait{color:var(--rose); font-weight:600}
  .passe-simple{color:var(--green); font-weight:600}
  .plus-que-parfait{color:var(--orange); font-weight:600}

  /* QCM */
  .qcm-controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px}
  .qcm-controls select,.qcm-controls button{padding:8px 10px; border-radius:10px; border:1px solid #e2e8f0; background:#fff; cursor:pointer}
  .qcm-question{border:1px solid #e2e8f0; border-radius:14px; padding:14px; margin:14px 0; background:#fff}
  .q-title{font-weight:600; margin-bottom:6px}
  .q-legend{font-size:.85rem; color:var(--muted); margin:6px 0 12px}
  .q-options{display:grid; gap:8px}
  .q-option{padding:9px 12px; border:1px solid #cbd5e1; border-radius:10px; cursor:pointer; background:#fff}
  .q-option:hover{background:#f8fafc}
  .correct{background:#dcfce7 !important; border-color:#86efac !important}
  .incorrect{background:#fee2e2 !important; border-color:#fca5a5 !important}
  .feedback{margin-top:10px; background:#f1f5f9; border-left:4px solid var(--brand); padding:10px; border-radius:8px}
  .progress{display:flex; align-items:center; gap:10px; margin-top:10px}
  .bar{flex:1; height:10px; background:#e2e8f0; border-radius:999px; overflow:hidden}
  .bar>span{display:block; height:100%; background:#10b981; width:0%}

  /* Exercices d'√©criture */
  .exemple{display:none; margin-top:8px; padding:12px; background:#f8fafc; border-left:4px solid var(--brand); border-radius:10px}
  .actions{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
  .btn{background:#0ea5e9; color:#fff; border:none; padding:8px 12px; border-radius:10px; cursor:pointer}
  .btn.secondary{background:#fff; color:#0f172a; border:1px solid #e2e8f0}

  /* Footer */
  footer{color:#64748b; text-align:center; padding:20px 10px}
</style>
</head>
<body>
  <header>
    <h1>R√©visions ‚Äî Les valeurs des temps du pass√©</h1>
    <p>Site p√©dagogique 4e : cours clair, QCM interactif, √©criture guid√©e, transformations.</p>
  </header>

  <nav>
    <button class="active" data-go="#cours">Cours</button>
    <button data-go="#tableau">Tableau m√©mo</button>
    <button data-go="#qcm">QCM (30)</button>
    <button data-go="#ecriture">√âcriture</button>
    <button data-go="#transfo">Transformation</button>
  </nav>

  <main>

    <!-- COURS -->
    <section id="cours" class="card">
      <h2>üìñ Le cours ‚Äî R√¥les des temps du pass√©</h2>
      <p class="legend">
        <span class="chip"><span class="imparfait">üå∏ Imparfait</span> : d√©cor, habitude, action de fond</span>
        <span class="chip"><span class="passe-simple">üíö Pass√© simple</span> : actions principales, successives</span>
        <span class="chip"><span class="plus-que-parfait">üüß Plus-que-parfait</span> : <em>d√©j√† avant</em> une autre action pass√©e</span>
      </p>

      <div class="card" style="box-shadow:none; border-style:dashed">
        <h3 class="imparfait">Imparfait ‚Äî üå∏</h3>
        <ul>
          <li><strong>Description/d√©cor</strong> : Il <span class="imparfait">faisait</span> doux, la ville <span class="imparfait">brillait</span>.</li>
          <li><strong>Habitude</strong> : Chaque soir, elle <span class="imparfait">lisait</span> au salon.</li>
          <li><strong>Action de fond</strong> : Je <span class="imparfait">marchais</span> quand la pluie commen√ßa.</li>
        </ul>
      </div>

      <div class="card" style="box-shadow:none; border-style:dashed">
        <h3 class="passe-simple">Pass√© simple ‚Äî üíö</h3>
        <ul>
          <li><strong>Action ponctuelle</strong> : Il <span class="passe-simple">entra</span> et <span class="passe-simple">salua</span>.</li>
          <li><strong>Actions successives</strong> : Il <span class="passe-simple">prit</span> son sac puis <span class="passe-simple">sortit</span>.</li>
        </ul>
      </div>

      <div class="card" style="box-shadow:none; border-style:dashed">
        <h3 class="plus-que-parfait">Plus-que-parfait ‚Äî üüß</h3>
        <ul>
          <li><strong>Ant√©riorit√©</strong> : action <em>achev√©e</em> <u>avant</u> un autre pass√©.</li>
          <li><strong>Formation</strong> : auxiliaire <em>avoir/√™tre</em> √† l‚Äôimparfait + participe pass√© : <em>j‚Äô<u>avais</u> termin√©</em>, <em>elle <u>√©tait</u> partie</em>.</li>
          <li><strong>Indices fr√©quents</strong> : d√©j√†, avant, lorsque, apr√®s que‚Ä¶</li>
        </ul>
        <p>Exemple : Quand j‚Äôarrivai (üíö), elle <span class="plus-que-parfait">avait d√©j√† mang√©</span> (üüß) ‚Üí le repas est <em>ant√©rieur</em> √† l‚Äôarriv√©e.</p>
      </div>
    </section>

    <!-- TABLEAU MEMO -->
    <section id="tableau" class="card">
      <h2>üß≠ Tableau m√©mo</h2>
      <table>
        <thead><tr><th>Temps</th><th>Valeurs</th><th>Exemple</th></tr></thead>
        <tbody>
          <tr>
            <td class="imparfait">Imparfait üå∏</td>
            <td>Description, habitude, action en cours</td>
            <td>Le vent <span class="imparfait">soufflait</span> dans les arbres.</td>
          </tr>
          <tr>
            <td class="passe-simple">Pass√© simple üíö</td>
            <td>Action ponctuelle, actions successives</td>
            <td>Il <span class="passe-simple">ouvrit</span> la porte et <span class="passe-simple">entra</span>.</td>
          </tr>
          <tr>
            <td class="plus-que-parfait">Plus-que-parfait üüß</td>
            <td>Action achev√©e <em>avant</em> un autre pass√© (ant√©riorit√©)</td>
            <td>Elle <span class="plus-que-parfait">avait rang√©</span> ses affaires.</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- QCM -->
    <section id="qcm" class="card">
      <h2>‚ùì QCM ‚Äî 30 questions (1 verbe = 1 analyse)</h2>
      <p class="legend">L√©gende (rappel dans chaque question) : üå∏ <span class="imparfait">Imparfait</span> ¬∑ üíö <span class="passe-simple">Pass√© simple</span> ¬∑ üüß <span class="plus-que-parfait">Plus-que-parfait</span></p>

      <div class="qcm-controls">
        <label>Filtrer :
          <select id="filter">
            <option value="all">Toutes</option>
            <option value="imparfait">Imparfait (üå∏)</option>
            <option value="passe-simple">Pass√© simple (üíö)</option>
            <option value="plus-que-parfait">Plus-que-parfait (üüß)</option>
          </select>
        </label>
        <button id="shuffle">M√©langer</button>
        <button id="reset" class="secondary">R√©initialiser</button>
        <div class="progress" style="margin-left:auto">
          <span id="scoreTxt">Score : 0 / 30</span>
          <div class="bar"><span id="barFill"></span></div>
        </div>
      </div>

      <div id="qcmContainer"></div>
    </section>

    <!-- ECRITURE -->
    <section id="ecriture" class="card">
      <h2>‚úçÔ∏è Exercices d‚Äô√©criture (avec exemples)</h2>

      <div class="card" style="box-shadow:none">
        <h3>1) Souvenir de vacances (5‚Äì6 lignes)</h3>
        <p>Utilise : 2 imparfaits (d√©cor/habitude) + 2 pass√©s simples (actions principales).</p>
        <div class="actions">
          <button class="btn" onclick="toggleEx('ex1')">Voir un exemple</button>
          <button class="btn secondary" onclick="copyEx('ex1')">Copier l‚Äôexemple</button>
        </div>
        <div id="ex1" class="exemple">
          Il <span class="imparfait">faisait</span> tr√®s doux et la mer <span class="imparfait">miroitait</span>.
          Nous <span class="passe-simple">march√¢mes</span> longtemps sur la jet√©e, puis
          un go√©land <span class="passe-simple">plongea</span> brusquement pr√®s de nous.
        </div>
      </div>

      <div class="card" style="box-shadow:none">
        <h3>2) Sc√®ne de classe (6 lignes)</h3>
        <p>3 imparfaits + 2 pass√©s simples + 1 plus-que-parfait (ant√©riorit√©).</p>
        <div class="actions">
          <button class="btn" onclick="toggleEx('ex2')">Voir un exemple</button>
          <button class="btn secondary" onclick="copyEx('ex2')">Copier l‚Äôexemple</button>
        </div>
        <div id="ex2" class="exemple">
          La salle <span class="imparfait">√©tait</span> silencieuse, chacun <span class="imparfait">√©crivait</span>.
          J‚Äô<span class="plus-que-parfait">avais termin√©</span> quand le professeur <span class="passe-simple">interrogea</span> Luc ;
          je <span class="passe-simple">levai</span> la main pendant que la pluie <span class="imparfait">cr√©pitait</span> dehors.
        </div>
      </div>

      <div class="card" style="box-shadow:none">
        <h3>3) Petit r√©cit fantastique (6‚Äì8 lignes)</h3>
        <p>Au moins 3 temps diff√©rents (üå∏ üíö üüß).</p>
        <div class="actions">
          <button class="btn" onclick="toggleEx('ex3')">Voir un exemple</button>
          <button class="btn secondary" onclick="copyEx('ex3')">Copier l‚Äôexemple</button>
        </div>
        <div id="ex3" class="exemple">
          Il <span class="imparfait">faisait</span> nuit quand une lueur <span class="passe-simple">apparut</span> au grenier.
          Je <span class="plus-que-parfait">n‚Äôavais jamais vu</span> pareille clart√© ;
          la porte <span class="passe-simple">grin√ßa</span> et un souffle <span class="imparfait">passait</span> derri√®re moi.
        </div>
      </div>

      <div class="card" style="box-shadow:none">
        <h3>4) Journal de bord (5 lignes)</h3>
        <p>Alterne d√©cor (imparfait) et actions principales (pass√© simple).</p>
        <div class="actions">
          <button class="btn" onclick="toggleEx('ex4')">Voir un exemple</button>
          <button class="btn secondary" onclick="copyEx('ex4')">Copier l‚Äôexemple</button>
        </div>
        <div id="ex4" class="exemple">
          Le quai <span class="imparfait">√©tait</span> d√©sert ; soudain, le train <span class="passe-simple">entra</span> en gare.
          Je <span class="passe-simple">montai</span> d‚Äôun pas d√©cid√© tandis que le vent <span class="imparfait">soufflait</span>.
        </div>
      </div>

      <div class="card" style="box-shadow:none">
        <h3>5) Fait divers (6 lignes)</h3>
        <p>Imparfait (contexte) + Pass√© simple (√©v√©nement) + Plus-que-parfait (cause ant√©rieure).</p>
        <div class="actions">
          <button class="btn" onclick="toggleEx('ex5')">Voir un exemple</button>
          <button class="btn secondary" onclick="copyEx('ex5')">Copier l‚Äôexemple</button>
        </div>
        <div id="ex5" class="exemple">
          Il <span class="imparfait">faisait</span> encore nuit quand l‚Äôaccident <span class="passe-simple">survint</span>.
          Le conducteur <span class="plus-que-parfait">avait frein√©</span> trop tard : la chauss√©e <span class="imparfait">glissait</span>.
        </div>
      </div>
    </section>

    <!-- TRANSFORMATION -->
    <section id="transfo" class="card">
      <h2>üîÑ Transformation ‚Äî du pr√©sent au pass√©</h2>

      <div class="card" style="box-shadow:none">
        <h3>Texte 1</h3>
        <blockquote>
          Aujourd‚Äôhui, la rue est calme et les enfants jouent. Je vois Paul et nous parlons devant la librairie.
        </blockquote>
        <div class="actions">
          <button class="btn" onclick="toggleEx('t1')">Voir une correction possible</button>
        </div>
        <div id="t1" class="exemple">
          Ce jour-l√†, la rue <span class="imparfait">√©tait</span> calme et les enfants <span class="imparfait">jouaient</span>.
          Je <span class="passe-simple">vis</span> Paul et nous <span class="passe-simple">parl√¢mes</span> devant la librairie.
        </div>
      </div>

      <div class="card" style="box-shadow:none">
        <h3>Texte 2 (avec ant√©riorit√©)</h3>
        <blockquote>
          Il arrive, regarde sa montre et sourit : il a d√©j√† termin√© son rapport.
        </blockquote>
        <div class="actions">
          <button class="btn" onclick="toggleEx('t2')">Voir une correction possible</button>
        </div>
        <div id="t2" class="exemple">
          Il <span class="passe-simple">arriva</span>, <span class="passe-simple">regarda</span> sa montre et <span class="passe-simple">sourit</span> :
          il <span class="plus-que-parfait">avait d√©j√† termin√©</span> son rapport
          <span style="color:#64748b">‚Äî formation : avait (imparfait) + termin√© (participe) ‚Üí action <em>achev√©e avant</em> l‚Äôarriv√©e.</span>
        </div>
      </div>
    </section>

  </main>

  <footer>Fiche & exercices ‚Äî 4e ‚Ä¢ Code couleur : üå∏ Imparfait ¬∑ üíö Pass√© simple ¬∑ üüß Plus-que-parfait</footer>

<script>
/* ------------------- Navigation douce ------------------- */
document.querySelectorAll('nav button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const sel = btn.getAttribute('data-go');
    document.querySelector(sel).scrollIntoView({behavior:'smooth', block:'start'});
  });
});

/* ------------------- Aide affichage exemples ------------------- */
function toggleEx(id){
  const el = document.getElementById(id);
  el.style.display = (el.style.display==='block') ? 'none' : 'block';
}
function copyEx(id){
  const el = document.getElementById(id);
  const tmp = el.innerText.replace(/\s+\n/g,'\n').trim();
  navigator.clipboard.writeText(tmp);
}

/* ------------------- Banque QCM (30) ------------------- */
/* R√®gle : 1 verbe cibl√© par question. Tenues: 'imparfait' | 'passe-simple' | 'plus-que-parfait' */
const QUESTIONS = [
  /* IMPARFAIT (10) */
  { tense:'imparfait',
    q:`Il <span class="imparfait">faisait</span> tr√®s froid ce matin-l√†.`,
    options:["description/d√©cor","action ponctuelle","ant√©riorit√©"],
    correct:0,
    feedback:"Imparfait = d√©cor/description durable. On installe l‚Äôarri√®re-plan de la sc√®ne."
  },
  { tense:'imparfait',
    q:`Ils <span class="imparfait">jouaient</span> souvent au parc apr√®s l‚Äô√©cole.`,
    options:["habitude","action ponctuelle","ant√©riorit√©"],
    correct:0,
    feedback:"Imparfait = habitude (indice: ¬´ souvent ¬ª)."
  },
  { tense:'imparfait',
    q:`La rue <span class="imparfait">√©tait</span> d√©serte.`,
    options:["description/d√©cor","actions successives","ant√©riorit√©"],
    correct:0,
    feedback:"Imparfait d√©crit un √©tat de fond (arri√®re-plan)."
  },
  { tense:'imparfait',
    q:`Le vent <span class="imparfait">soufflait</span> dans les arbres.`,
    options:["description/d√©cor","action ponctuelle","ant√©riorit√©"],
    correct:0,
    feedback:"Imparfait = description continue du cadre."
  },
  { tense:'imparfait',
    q:`Je <span class="imparfait">lisais</span> tranquillement quand on frappa.`,
    options:["action de fond/en cours","action principale ponctuelle","ant√©riorit√©"],
    correct:0,
    feedback:"Imparfait = action en cours sur laquelle se greffe un √©v√©nement."
  },
  { tense:'imparfait',
    q:`Nous <span class="imparfait">allions</span> chaque dimanche au march√©.`,
    options:["habitude","action ponctuelle","ant√©riorit√©"],
    correct:0,
    feedback:"Imparfait = habitude (fr√©quence r√©guli√®re)."
  },
  { tense:'imparfait',
    q:`La maison <span class="imparfait">semblait</span> abandonn√©e.`,
    options:["description/d√©cor","action ponctuelle","ant√©riorit√©"],
    correct:0,
    feedback:"Imparfait = description/√©tat prolong√©."
  },
  { tense:'imparfait',
    q:`Elle <span class="imparfait">portait</span> toujours une √©charpe rouge.`,
    options:["habitude","action ponctuelle","ant√©riorit√©"],
    correct:0,
    feedback:"Imparfait = habitude (indice: ¬´ toujours ¬ª)."
  },
  { tense:'imparfait',
    q:`Il <span class="imparfait">marchait</span> pr√®s de la rivi√®re.`,
    options:["action de fond/en cours","action ponctuelle","ant√©riorit√©"],
    correct:0,
    feedback:"Imparfait = action en cours, non born√©e."
  },
  { tense:'imparfait',
    q:`Les enfants <span class="imparfait">riaient</span> dans la cour.`,
    options:["arri√®re-plan/description","action ponctuelle","ant√©riorit√©"],
    correct:0,
    feedback:"Imparfait = ambiance/activit√© de fond."
  },

  /* PASSE SIMPLE (10) */
  { tense:'passe-simple',
    q:`Il <span class="passe-simple">entra</span> sans frapper.`,
    options:["description/d√©cor","action ponctuelle","ant√©riorit√©"],
    correct:1,
    feedback:"Pass√© simple = action ponctuelle qui fait avancer le r√©cit."
  },
  { tense:'passe-simple',
    q:`La porte <span class="passe-simple">claqua</span> violemment.`,
    options:["habitude","action br√®ve","ant√©riorit√©"],
    correct:1,
    feedback:"Pass√© simple = action br√®ve/soudaine."
  },
  { tense:'passe-simple',
    q:`Ils <span class="passe-simple">partirent</span> √† l‚Äôaube.`,
    options:["habitude","action ponctuelle","ant√©riorit√©"],
    correct:1,
    feedback:"Pass√© simple = action born√©e (√©v√©nement)."
  },
  { tense:'passe-simple',
    q:`Je <span class="passe-simple">vis</span> un √©clair au loin.`,
    options:["description/d√©cor","action ponctuelle","ant√©riorit√©"],
    correct:1,
    feedback:"Pass√© simple = perception ponctuelle."
  },
  { tense:'passe-simple',
    q:`Il <span class="passe-simple">prit</span> son sac.`,
    options:["habitude","action ponctuelle","ant√©riorit√©"],
    correct:1,
    feedback:"Pass√© simple = action isol√©e, premi√®re du encha√Ænement."
  },
  { tense:'passe-simple',
    q:`Elle <span class="passe-simple">√©crivit</span> quelques lignes.`,
    options:["habitude","action ponctuelle","ant√©riorit√©"],
    correct:1,
    feedback:"Pass√© simple = fait ponctuel d√©termin√©."
  },
  { tense:'passe-simple',
    q:`Ils <span class="passe-simple">firent</span> leurs devoirs puis <span class="passe-simple">s‚Äôendormirent</span>.`,
    options:["actions successives","habitude","ant√©riorit√©"],
    correct:0,
    feedback:"Pass√© simple = cha√Æne d‚Äôactions successives (premier plan)."
  },
  { tense:'passe-simple',
    q:`Il <span class="passe-simple">ouvrit</span> la fen√™tre.`,
    options:["description/d√©cor","action ponctuelle","ant√©riorit√©"],
    correct:1,
    feedback:"Pass√© simple = √©v√©nement bref, d√©cisif."
  },
  { tense:'passe-simple',
    q:`Je <span class="passe-simple">compris</span> aussit√¥t.`,
    options:["habitude","action ponctuelle","ant√©riorit√©"],
    correct:1,
    feedback:"Pass√© simple = prise de conscience instantan√©e."
  },
  { tense:'passe-simple',
    q:`Elle <span class="passe-simple">s‚Äôenfuit</span> dans la nuit.`,
    options:["habitude","action ponctuelle","ant√©riorit√©"],
    correct:1,
    feedback:"Pass√© simple = action unique/ponctuelle."
  },

  /* PLUS-QUE-PARFAIT (10) ‚Äî feedback d√©taill√© */
  { tense:'plus-que-parfait',
    q:`Elle <span class="plus-que-parfait">avait d√©j√† mang√©</span>.`,
    options:["habitude","ant√©riorit√© (d√©j√† avant)","description"],
    correct:1,
    feedback:"Plus-que-parfait = <em>avoir</em> √† l‚Äôimparfait (avait) + participe (mang√©). L‚Äôaction √©tait <strong>d√©j√† achev√©e</strong> avant une autre action pass√©e (explicite ou implicite)."
  },
  { tense:'plus-que-parfait',
    q:`Il <span class="plus-que-parfait">avait rang√©</span> ses affaires.`,
    options:["description","ant√©riorit√© (d√©j√† avant)","action ponctuelle au premier plan"],
    correct:1,
    feedback:"Plus-que-parfait = ant√©riorit√© : le rangement est termin√© <em>avant</em> l‚Äô√©v√©nement principal."
  },
  { tense:'plus-que-parfait',
    q:`Elle <span class="plus-que-parfait">√©tait partie</span> t√¥t.`,
    options:["habitude","ant√©riorit√© (d√©j√† avant)","description"],
    correct:1,
    feedback:"Plus-que-parfait avec <em>√™tre</em> (√©tait + participe) ‚Üí action <strong>achev√©e ant√©rieure</strong> (accord possible du participe)."
  },
  { tense:'plus-que-parfait',
    q:`Nous <span class="plus-que-parfait">avions lu</span> le livre.`,
    options:["description","ant√©riorit√© (d√©j√† avant)","action ponctuelle au premier plan"],
    correct:1,
    feedback:"Plus-que-parfait = rep√®re ant√©rieur : la lecture est termin√©e avant l‚Äôautre pass√©."
  },
  { tense:'plus-que-parfait',
    q:`Il <span class="plus-que-parfait">avait termin√©</span> son rapport.`,
    options:["description","ant√©riorit√© (d√©j√† avant)","habitude"],
    correct:1,
    feedback:"Formation : <em>avait</em> (imparfait) + <em>termin√©</em> (participe). Valeur : <strong>d√©j√† fait</strong> avant l‚Äô√©v√©nement suivant."
  },
  { tense:'plus-que-parfait',
    q:`On <span class="plus-que-parfait">avait pos√©</span> les valises.`,
    options:["description","ant√©riorit√© (d√©j√† avant)","action ponctuelle au premier plan"],
    correct:1,
    feedback:"Plus-que-parfait = action accomplie ant√©rieurement (valise d√©j√† pos√©e quand la suite du r√©cit arrive)."
  },
  { tense:'plus-que-parfait',
    q:`Ils <span class="plus-que-parfait">avaient compris</span> la r√®gle.`,
    options:["habitude","ant√©riorit√© (d√©j√† avant)","description"],
    correct:1,
    feedback:"Plus-que-parfait = r√©sultat acquis avant une autre action pass√©e (ils comprennent <em>d√©j√†</em>)."
  },
  { tense:'plus-que-parfait',
    q:`Elle <span class="plus-que-parfait">√©tait n√©e</span> en hiver.`,
    options:["description","ant√©riorit√© (rep√®re biographique)","action ponctuelle au premier plan"],
    correct:1,
    feedback:"Avec <em>√™tre</em> : ¬´ √©tait n√©e ¬ª. Rep√®re ant√©rieur stable dans le pass√©."
  },
  { tense:'plus-que-parfait',
    q:`Il <span class="plus-que-parfait">avait √©crit</span> la lettre.`,
    options:["description","ant√©riorit√© (d√©j√† avant)","habitude"],
    correct:1,
    feedback:"Plus-que-parfait = l‚Äô√©criture est d√©j√† achev√©e avant une autre action (ex. l‚Äôenvoi, l‚Äôarriv√©e)."
  },
  { tense:'plus-que-parfait',
    q:`La gardienne <span class="plus-que-parfait">avait ferm√©</span> la porte.`,
    options:["description","ant√©riorit√© (d√©j√† avant)","action au premier plan"],
    correct:1,
    feedback:"Formation : <em>avait</em> + <em>ferm√©</em>. Valeur : √©tat r√©sultant acquis avant l‚Äô√©v√©nement principal (porte d√©j√† close)."
  }
];

/* ------------------- Construction UI QCM ------------------- */
const cont = document.getElementById('qcmContainer');
let order = [...QUESTIONS.keys()];
let answered = Array(QUESTIONS.length).fill(null); // true/false/null

function smallLegend(){
  return `<div class="q-legend">üå∏ <span class="imparfait">Imparfait</span> ¬∑ üíö <span class="passe-simple">Pass√© simple</span> ¬∑ üüß <span class="plus-que-parfait">Plus-que-parfait</span></div>`;
}

function render(filter='all'){
  cont.innerHTML = '';
  const list = order
    .map(i => ({...QUESTIONS[i], idx:i}))
    .filter(it => filter==='all' ? true : it.tense===filter);

  list.forEach((item, k) =>{
    const card = document.createElement('div');
    card.className = 'qcm-question';
    const num = k+1;
    card.innerHTML = `
      <div class="q-title">Q${num}. ${item.q}</div>
      ${smallLegend()}
      <div class="q-options">
        ${item.options.map((opt,i)=>`
          <button class="q-option" data-i="${item.idx}" data-choice="${i}">
            ${String.fromCharCode(97+i)}) ${opt}
          </button>`).join('')}
      </div>
      <div class="feedback" id="fb-${item.idx}" style="display:none"></div>
    `;
    cont.appendChild(card);
  });

  // Attach handlers
  cont.querySelectorAll('.q-option').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const qi = Number(btn.getAttribute('data-i'));
      const choice = Number(btn.getAttribute('data-choice'));
      const qBlock = btn.closest('.qcm-question');
      const all = qBlock.querySelectorAll('.q-option');
      all.forEach(b=>b.classList.remove('correct','incorrect'));
      const fb = document.getElementById(`fb-${qi}`);
      fb.style.display='block';

      if(choice === QUESTIONS[qi].correct){
        btn.classList.add('correct');
        answered[qi] = true;
        fb.innerHTML = `‚úÖ ${QUESTIONS[qi].feedback}`;
      } else {
        btn.classList.add('incorrect');
        // show correct one within this block (same label text)
        all[QUESTIONS[qi].correct].classList.add('correct');
        answered[qi] = false;
        fb.innerHTML = `‚ùå Mauvais choix.<br>${QUESTIONS[qi].feedback}`;
      }
      updateScore();
    });
  });

  updateScore();
}

function updateScore(){
  const done = answered.filter(v => v!==null).length;
  const good = answered.filter(v => v===true).length;
  document.getElementById('scoreTxt').textContent = `Score : ${good} / ${QUESTIONS.length}`;
  const bar = document.getElementById('barFill');
  bar.style.width = `${(good/QUESTIONS.length)*100}%`;
}

document.getElementById('filter').addEventListener('change', e=>{
  render(e.target.value);
});
document.getElementById('shuffle').addEventListener('click', ()=>{
  // Fisher‚ÄìYates
  for(let i=order.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [order[i],order[j]] = [order[j],order[i]];
  }
  render(document.getElementById('filter').value);
});
document.getElementById('reset').addEventListener('click', ()=>{
  answered = Array(QUESTIONS.length).fill(null);
  order = [...QUESTIONS.keys()];
  document.getElementById('filter').value='all';
  render('all');
});

render('all');
</script>
</body>
</html>
